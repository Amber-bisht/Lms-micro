%% LMS Microservices Architecture - Mermaid Diagram
%% View this at: https://mermaid.live or in GitHub

graph TB
    subgraph "Client Layer"
        FE[React Frontend<br/>Port 5173<br/>- Auth UI<br/>- Video Player<br/>- Course Browser<br/>- Admin Dashboard]
    end

    subgraph "API Gateway Layer"
        GW[API Gateway<br/>Port 3000<br/>- Routing<br/>- CORS<br/>- Rate Limiting<br/>- Health Checks]
    end

    subgraph "Microservices Layer"
        AUTH[Auth Service<br/>Port 3001<br/>- OAuth Google/GitHub<br/>- JWT/Sessions<br/>- User Management<br/>- Passport.js]
        
        COURSE[Course Service<br/>Port 3004<br/>- Courses CRUD<br/>- Enrollment<br/>- Progress Tracking<br/>- Lessons]
        
        UPLOAD[Uploader Service<br/>Port 3005<br/>- File Upload<br/>- Video Queue<br/>- FFmpeg Processing<br/>- HLS Conversion]
        
        MEDIA[Media Service<br/>Port 3008<br/>- YouTube API<br/>- Dailymotion<br/>- Video Search<br/>- Metadata]
        
        COMMUNITY[Community Service<br/>Port 3009<br/>- Comments<br/>- Reviews<br/>- Ratings<br/>- Discussions]
        
        ADMIN[Admin Service<br/>Port 3010<br/>- Analytics<br/>- User Management<br/>- Moderation<br/>- Cache Control]
    end

    subgraph "Data Layer"
        MONGO[(MongoDB<br/>Port 27017<br/>- lms-auth<br/>- lms-courses<br/>- lms-uploader<br/>- lms-community)]
        
        REDIS[(Redis<br/>Port 6379<br/>- Sessions<br/>- Bull Queue<br/>- Rate Limits<br/>- Cache)]
    end

    subgraph "Processing Layer"
        QUEUE[Bull Queue<br/>Redis-based<br/>- Video Jobs<br/>- Job Status<br/>- Retries]
        
        FFMPEG[FFmpeg<br/>- Transcode 720p<br/>- Transcode 1080p<br/>- Generate HLS<br/>- Create Thumbnails]
        
        HLS[HLS Output<br/>- .m3u8 Playlists<br/>- .ts Segments<br/>- Adaptive Bitrate<br/>- Thumbnails]
    end

    subgraph "Storage Layer"
        S3[AWS S3 / CDN<br/>- Video Storage<br/>- HLS Segments<br/>- Thumbnails<br/>- Presigned URLs]
        
        LOCAL[Local Storage<br/>- /uploads<br/>- Development<br/>- File Serving]
    end

    subgraph "External Services"
        YT[YouTube API<br/>- Video Search<br/>- Metadata<br/>- Thumbnails<br/>- Statistics]
        
        OAUTH[OAuth Providers<br/>- Google OAuth<br/>- GitHub OAuth<br/>- User Info<br/>- Profiles]
        
        DM[Dailymotion API<br/>- Video Search<br/>- Metadata<br/>- Embeds]
    end

    %% Client to Gateway
    FE -->|HTTP/HTTPS<br/>Cookies| GW

    %% Gateway to Services
    GW -->|/api/auth| AUTH
    GW -->|/api/courses| COURSE
    GW -->|/api/upload<br/>/api/videos| UPLOAD
    GW -->|/api/media| MEDIA
    GW -->|/api/comments<br/>/api/reviews| COMMUNITY
    GW -->|/api/admin| ADMIN

    %% Services to Data Layer
    AUTH -->|Read/Write| MONGO
    AUTH -->|Sessions| REDIS
    
    COURSE -->|Read/Write| MONGO
    
    UPLOAD -->|Read/Write| MONGO
    UPLOAD -->|Jobs| REDIS
    
    COMMUNITY -->|Read/Write| MONGO
    
    ADMIN -->|Cache| REDIS

    %% Video Processing Flow
    UPLOAD -->|Queue Job| QUEUE
    QUEUE -->|Process| FFMPEG
    FFMPEG -->|Output| HLS
    HLS -->|Upload| S3
    HLS -->|Store| LOCAL

    %% External Service Connections
    AUTH -->|OAuth| OAUTH
    MEDIA -->|API Calls| YT
    MEDIA -->|API Calls| DM

    %% Service to Service Communication
    COURSE -.->|Verify User| AUTH
    UPLOAD -.->|Course Info| COURSE
    COMMUNITY -.->|Course Exists| COURSE

    %% Styling
    classDef frontend fill:#61dafb,stroke:#333,stroke-width:2px,color:#000
    classDef gateway fill:#ff6b6b,stroke:#333,stroke-width:2px,color:#fff
    classDef service fill:#4ecdc4,stroke:#333,stroke-width:2px,color:#000
    classDef data fill:#95e1d3,stroke:#333,stroke-width:2px,color:#000
    classDef processing fill:#feca57,stroke:#333,stroke-width:2px,color:#000
    classDef storage fill:#48dbfb,stroke:#333,stroke-width:2px,color:#000
    classDef external fill:#a29bfe,stroke:#333,stroke-width:2px,color:#000

    class FE frontend
    class GW gateway
    class AUTH,COURSE,UPLOAD,MEDIA,COMMUNITY,ADMIN service
    class MONGO,REDIS data
    class QUEUE,FFMPEG,HLS processing
    class S3,LOCAL storage
    class YT,OAUTH,DM external

